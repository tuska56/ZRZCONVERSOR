<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora ZRZ - Linealidad A/B</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* === ESTILOS SIN CAMBIOS === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; margin-bottom: 10px; font-size: 28px; }
        .subtitle { color: #7f8c8d; margin-bottom: 30px; font-size: 14px; }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #fafafa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .section h2 { color: #2c3e50; margin-bottom: 15px; font-size: 18px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input[type="number"], input[type="file"] {
            width: 100%; max-width: 300px; padding: 10px;
            border: 1px solid #ddd; border-radius: 4px;
        }
        button {
            background: #3498db; color: white; border: none;
            padding: 10px 20px; border-radius: 4px;
            cursor: pointer;
        }
        button.secondary { background: #95a5a6; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { padding: 10px; text-align: center; border: 1px solid #ddd; }
        th { background: #34495e; color: white; }
        .hidden { display: none; }
    </style>
</head>

<body>
<div class="container">
    <h1>Calculadora ZRZ - Linealidad A/B</h1>
    <p class="subtitle">CÃ¡lculo ZRZ a partir de rectitudes invertidas</p>

    <div class="section">
        <h2>Radio de mediciÃ³n</h2>
        <label>R (mm)</label>
        <input type="number" id="radioInput" value="50">
    </div>

    <div class="section">
        <h2>Datos</h2>
        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" onchange="handleFileUpload(event)">
        <table>
            <thead>
                <tr>
                    <th>Z (mm)</th>
                    <th>A_error (Âµm/m)</th>
                    <th>B_error (Âµm/m)</th>
                </tr>
            </thead>
            <tbody id="dataTableBody"></tbody>
        </table>
        <button onclick="addRow()">AÃ±adir fila</button>
    </div>

    <div class="section">
        <button onclick="calculateZRZ()">Calcular ZRZ</button>
    </div>

    <div class="section hidden" id="resultsSection">
        <h2>Resultados</h2>
        <table>
            <thead>
                <tr>
                    <th>Z (mm)</th>
                    <th>ZRZ (Âµm/m)</th>
                </tr>
            </thead>
            <tbody id="resultsTableBody"></tbody>
        </table>
    </div>
</div>

<script>
let results = [];

function addRow() {
    const tbody = document.getElementById("dataTableBody");
    const row = tbody.insertRow();
    row.innerHTML = `
        <td><input type="number"></td>
        <td><input type="number"></td>
        <td><input type="number"></td>
    `;
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = e => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        const tbody = document.getElementById("dataTableBody");
        tbody.innerHTML = "";

        for (let i = 1; i < rows.length; i++) {
            if (rows[i].length >= 3) {
                const r = tbody.insertRow();
                r.innerHTML = `
                    <td><input type="number" value="${rows[i][0]}"></td>
                    <td><input type="number" value="${rows[i][1]}"></td>
                    <td><input type="number" value="${rows[i][2]}"></td>
                `;
            }
        }
    };

    reader.readAsArrayBuffer(file);
}

/* ===========================
   ðŸ”§ CÃLCULO CORREGIDO AQUÃ
   =========================== */
function calculateZRZ() {
    const R = parseFloat(document.getElementById("radioInput").value);
    const rows = document.querySelectorAll("#dataTableBody tr");
    const resultsBody = document.getElementById("resultsTableBody");

    resultsBody.innerHTML = "";
    results = [];

    rows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        const z = parseFloat(inputs[0].value);
        const A = parseFloat(inputs[1].value); // Âµm/m
        const B = parseFloat(inputs[2].value); // Âµm/m

        if (!isNaN(z) && !isNaN(A) && !isNaN(B)) {

            // âœ” FÃ“RMULA CORRECTA
            const zrz = (A - B) / (2 * R); // Âµm/m

            results.push({ z, zrz });

            const r = resultsBody.insertRow();
            r.innerHTML = `
                <td>${z.toFixed(3)}</td>
                <td>${zrz.toFixed(4)}</td>
            `;
        }
    });

    document.getElementById("resultsSection").classList.remove("hidden");
}
</script>
</body>
</html>
